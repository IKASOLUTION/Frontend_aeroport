<div class="flex justify-between items-center mb-6">
  <h3 class="text-3xl font-semibold text-gray-800">Registre des Passagers</h3>
  <div class="flex space-x-2">
    <a routerLink="/gestion-enregistrements" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 flex items-center">
      <i class="fa-solid fa-clipboard-check mr-2"></i>
      Effectuer un Enregistrement
    </a>
    <button (click)="openPdfModal(passagersFiltres(), 'Registre des Passagers')" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 flex items-center">
        <i class="fa-solid fa-file-pdf mr-2"></i>
        Exporter en PDF
    </button>
  </div>
</div>

<!-- Section Filtres -->
<div class="mb-6 bg-white shadow-md rounded-lg p-6">
  <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
    <!-- Recherche globale -->
    <div class="md:col-span-12 lg:col-span-4">
      <label for="search" class="block text-sm font-medium text-gray-700">Recherche globale</label>
      <input type="text" id="search" name="search" [(ngModel)]="filtreRecherche" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm bg-white text-gray-900" placeholder="Nom, document, vol...">
    </div>
    <!-- Aéroport -->
    <div class="md:col-span-6 lg:col-span-4">
      <label for="aeroport" class="block text-sm font-medium text-gray-700">Aéroport</label>
      <select id="aeroport" name="aeroport" [(ngModel)]="filtreAeroport" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm bg-white text-gray-900">
        <option value="">Tous les aéroports</option>
        @for(aeroport of aeroports(); track aeroport.id) {
          <option [value]="aeroport.nom_aeroport">{{aeroport.nom_aeroport}}</option>
        }
      </select>
    </div>
    <!-- État du voyage -->
    <div class="md:col-span-6 lg:col-span-4">
      <label for="etat-voyage" class="block text-sm font-medium text-gray-700">État du voyage</label>
      <select id="etat-voyage" name="etat-voyage" [(ngModel)]="filtreEtatVoyage" class="mt-1 block w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm bg-white text-gray-900">
        <option value="">Tous les états</option>
        @for(etat of etatsVoyage(); track etat) {
          <option [value]="etat">{{etat}}</option>
        }
      </select>
    </div>
    <!-- Numéro de vol -->
    <div class="md:col-span-12 lg:col-span-4">
      <label for="num-vol" class="block text-sm font-medium text-gray-700">Numéro de vol</label>
      <input type="text" id="num-vol" name="num-vol" [(ngModel)]="filtreNumeroVol" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm bg-white text-gray-900" placeholder="Ex: AF123">
    </div>
    <!-- Date début -->
    <div class="md:col-span-6 lg:col-span-4">
      <label for="date-debut" class="block text-sm font-medium text-gray-700">Date début</label>
      <input type="date" id="date-debut" name="date-debut" [(ngModel)]="filtreDateDebut" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm bg-white text-gray-900">
    </div>
    <!-- Date fin -->
    <div class="md:col-span-6 lg:col-span-4">
      <label for="date-fin" class="block text-sm font-medium text-gray-700">Date fin</label>
      <input type="date" id="date-fin" name="date-fin" [(ngModel)]="filtreDateFin" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm bg-white text-gray-900">
    </div>
  </div>
</div>

<div class="bg-white shadow-lg rounded-lg overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Photo</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Identité</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vol</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Itinéraire</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date/Heure</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut/Date</th>
          <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        @for (item of passagersPagines(); track item.passager.id_unique) {
          <tr class="hover:bg-emerald-50 transition-colors duration-200">
            <td class="px-6 py-4 whitespace-nowrap">
              <img class="h-10 w-10 rounded-full object-cover" [src]="item.passager.photo_profil_url" alt="Photo du passager">
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <div class="font-medium text-gray-900">{{ item.passager.prenom }} {{ item.passager.nom }}</div>
              <div class="text-gray-500">{{ item.nombreVoyages }} voyage(s)</div>
            </td>
             <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ item.passager.numero_document }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <div class="font-medium text-gray-900">{{ item.dernierVoyage.numero_vol }}</div>
              <div class="text-gray-500">N° Enreg: {{ item.dernierVoyage.numero_enregistrement }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ item.dernierVoyage.ville_depart }} <i class="fa-solid fa-arrow-right mx-1 text-gray-400"></i> {{ item.dernierVoyage.ville_destination }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              <div>{{ item.dernierVoyage.date_voyage }}</div>
              <div class="text-gray-500">{{ item.dernierVoyage.heure_voyage }}</div>
            </td>
             <td class="px-6 py-4 whitespace-nowrap">
              <span class="relative inline-block px-3 py-1 font-semibold leading-tight rounded-full text-xs" [class]="getStatusClass(item.dernierVoyage.statut)">
                {{ item.dernierVoyage.statut }}
              </span>
               <div class="text-xs text-gray-500 mt-1">{{ item.dernierVoyage.date_creation }}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <div class="flex items-center justify-center space-x-2">
                <button (click)="openDetailsModal(item)" class="p-2 rounded-full text-gray-400 hover:bg-green-100 hover:text-green-600 transition-colors duration-200" title="Détails">
                   <i class="fa-solid fa-eye text-base"></i>
                </button>
                <button (click)="openPdfModal(item, 'Fiche Passager - ' + item.passager.prenom + ' ' + item.passager.nom)" class="p-2 rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 transition-colors duration-200" title="Exporter en PDF">
                   <i class="fa-solid fa-file-pdf text-base"></i>
                </button>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="8" class="px-6 py-12 text-center text-gray-500">
              <div class="flex flex-col items-center">
                <i class="fa-solid fa-users text-4xl text-gray-300 mb-4"></i>
                <h4 class="text-lg font-semibold text-gray-600">Aucun passager trouvé</h4>
                <p class="text-sm">Essayez de modifier votre filtre ou d'effectuer un enregistrement.</p>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div class="px-5 py-5 bg-white border-t flex flex-col xs:flex-row items-center xs:justify-between">
    <span class="text-xs xs:text-sm text-gray-900">{{ paginationText() }}</span>
    <div class="inline-flex mt-2 xs:mt-0 space-x-2">
      <button (click)="pagePrecedente()" [disabled]="currentPage() === 1" class="text-sm font-semibold py-2 px-4 rounded transition duration-150 ease-in-out" [class]="currentPage() === 1 ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-gray-300 hover:bg-gray-400 text-gray-800'">Précédent</button>
      <button (click)="pageSuivante()" [disabled]="currentPage() === totalPages() || totalPages() === 0" class="text-sm font-semibold py-2 px-4 rounded transition duration-150 ease-in-out" [class]="(currentPage() === totalPages() || totalPages() === 0) ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-gray-300 hover:bg-gray-400 text-gray-800'">Suivant</button>
    </div>
  </div>
</div>

<!-- Modale Détails Passager -->
@if (isDetailsModalOpen() && selectedPassagerComplet(); as data) {
  <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4" (click)="closeModals()">
    <div class="bg-white rounded-lg shadow-2xl p-8 max-w-7xl w-full" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-center mb-6 pb-4 border-b">
        <h3 class="text-2xl font-bold text-gray-800">Détails du Passager : {{ data.passager.prenom }} {{ data.passager.nom }}</h3>
        <div class="flex items-center space-x-3">
          <button type="button" (click)="closeModals()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Retour à la liste</button>
          <button (click)="openPdfModal(data, 'Fiche Passager - ' + data.passager.prenom + ' ' + data.passager.nom)" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm flex items-center">
            <i class="fa-solid fa-print mr-2"></i>Imprimer PDF
          </button>
        </div>
      </div>

      <div class="max-h-[75vh] overflow-y-auto pr-4 space-y-8">
        <!-- Section Biométrie Visuelle -->
        <section>
          <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Documents Visuels</h4>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            <div class="text-center p-3 bg-gray-50 rounded-lg border flex flex-col items-center justify-start space-y-2">
              <h5 class="font-semibold text-gray-600 text-sm">Photo de profil</h5>
              <img [src]="data.passager.photo_profil_url" alt="Photo de profil" class="w-28 h-28 object-cover rounded-full border-2 border-white shadow-sm cursor-pointer hover:scale-105 transition-transform" (click)="openImageViewer(0)">
            </div>
            <div class="text-center p-3 bg-gray-50 rounded-lg border flex flex-col items-center justify-start space-y-2">
              <h5 class="font-semibold text-gray-600 text-sm">Photo d'identité</h5>
              <img [src]="data.passager.photo_identite_url" alt="Photo d'identité" class="w-full h-36 object-contain rounded cursor-pointer hover:opacity-80 transition-opacity" (click)="openImageViewer(1)">
            </div>
            <div class="text-center p-3 bg-gray-50 rounded-lg border flex flex-col items-center justify-start space-y-2">
              <h5 class="font-semibold text-gray-600 text-sm">Document Recto</h5>
              <img [src]="data.passager.doc_recto_url" alt="Document Recto" class="w-full h-36 object-contain rounded cursor-pointer hover:opacity-80 transition-opacity" (click)="openImageViewer(2)">
            </div>
            <div class="text-center p-3 bg-gray-50 rounded-lg border flex flex-col items-center justify-start space-y-2">
              <h5 class="font-semibold text-gray-600 text-sm">Document Verso</h5>
              <img [src]="data.passager.doc_verso_url" alt="Document Verso" class="w-full h-36 object-contain rounded cursor-pointer hover:opacity-80 transition-opacity" (click)="openImageViewer(3)">
            </div>
          </div>
        </section>

        <!-- Informations d'identité -->
        <section>
          <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Informations d'identité</h4>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 text-sm">
            <div class="md:col-span-3 space-y-1"><p class="text-gray-500">Nom complet:</p><p class="font-medium text-gray-900">{{ data.passager.prenom }} {{ data.passager.nom }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Date de naissance:</p><p class="font-medium text-gray-900">{{ data.passager.date_naissance }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Nationalité:</p><p class="font-medium text-gray-900">{{ data.passager.nationalite }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Profession:</p><p class="font-medium text-gray-900">{{ data.passager.profession }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Lieu de naissance:</p><p class="font-medium text-gray-900">{{ data.passager.lieu_naissance }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Pays de résidence:</p><p class="font-medium text-gray-900">{{ data.passager.pays_residence }}</p></div>
          </div>
        </section>

        <!-- Coordonnées -->
        <section>
          <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Coordonnées</h4>
          <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-sm">
            <div class="space-y-1"><p class="text-gray-500">Adresse à l'étranger:</p><p class="font-medium text-gray-900">{{ data.passager.adresse_etranger }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Téléphone à l'étranger:</p><p class="font-medium text-gray-900">{{ data.passager.telephone_etranger }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Adresse au Burkina Faso:</p><p class="font-medium text-gray-900">{{ data.passager.adresse_burkina }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Téléphone au Burkina:</p><p class="font-medium text-gray-900">{{ data.passager.telephone_burkina }}</p></div>
            <div class="col-span-2 space-y-1"><p class="text-gray-500">Email:</p><p class="font-medium text-gray-900">{{ data.passager.email || 'Non renseigné' }}</p></div>
          </div>
        </section>
        
        <!-- Documents -->
        <section>
          <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Documents</h4>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 text-sm">
            <div class="space-y-1"><p class="text-gray-500">Type de document:</p><p class="font-medium text-gray-900">{{ data.passager.type_document }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Numéro du document:</p><p class="font-mono font-medium text-gray-900">{{ data.passager.numero_document }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Date de délivrance:</p><p class="font-medium text-gray-900">{{ data.passager.date_delivrance_doc }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Lieu de délivrance:</p><p class="font-medium text-gray-900">{{ data.passager.lieu_delivrance_doc }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Code empreinte:</p><p class="font-mono font-medium text-gray-900">{{ data.passager.code_empreinte }}</p></div>
            <div class="md:col-span-3 space-y-1"><p class="text-gray-500">Numéro identifiant unique:</p><p class="font-mono font-medium text-gray-900">{{ data.passager.id_unique }}</p></div>
          </div>
        </section>
        
        <!-- Informations de voyage (Dernier) -->
        <section>
          <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Informations de voyage (Dernier)</h4>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 text-sm">
            <div class="space-y-1"><p class="text-gray-500">Numéro de vol:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.numero_vol }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">État du voyage:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.etat_voyage }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Date et heure:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.date_voyage }} à {{ data.dernierVoyage.heure_voyage }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Venant de:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.ville_depart }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Allant à:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.ville_destination }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Durée du séjour:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.duree_sejour }} jours</p></div>
            <div class="space-y-1"><p class="text-gray-500">Motif du voyage:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.motif_voyage }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Statut:</p><p class="font-medium"><span class="px-2 py-1 text-xs rounded-full" [class]="getStatusClass(data.dernierVoyage.statut)">{{ data.dernierVoyage.statut }}</span></p></div>
          </div>
        </section>
        
        <!-- Traçabilité -->
        <section>
          <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Traçabilité</h4>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 text-sm">
            <div class="space-y-1"><p class="text-gray-500">Aéroport:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.nom_aeroport }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Numéro d'enregistrement:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.numero_enregistrement }}</p></div>
            <div class="space-y-1"><p class="text-gray-500">Créé le:</p><p class="font-medium text-gray-900">{{ data.dernierVoyage.date_creation }}</p></div>
          </div>
        </section>

        <!-- Historique des déplacements -->
        <section>
            <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Historique des déplacements ({{ data.nombreVoyages }} voyages)</h4>
            <div class="border rounded-lg overflow-hidden">
              <table class="min-w-full divide-y divide-gray-200 text-sm">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">N°</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Vol</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Venant de</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Allant à</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">État</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aéroport</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  @for(voyage of data.historiqueVoyages; track voyage.id; let i = $index) {
                    <tr class="hover:bg-gray-50">
                      <td class="px-4 py-2 font-medium text-gray-500">{{ i + 1 }}</td>
                      <td class="px-4 py-2 text-gray-900">{{ voyage.date_voyage }} <span class="text-gray-500">{{ voyage.heure_voyage }}</span></td>
                      <td class="px-4 py-2 font-medium text-gray-900">{{ voyage.numero_vol }}</td>
                      <td class="px-4 py-2 text-gray-900">{{ voyage.ville_depart }}</td>
                      <td class="px-4 py-2 text-gray-900">{{ voyage.ville_destination }}</td>
                      <td class="px-4 py-2 text-gray-900">{{ voyage.etat_voyage }}</td>
                      <td class="px-4 py-2 text-gray-900">{{ voyage.nom_aeroport }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
        </section>
      </div>
    </div>
  </div>
}

<!-- Modale Visionneuse d'images -->
@if (isImageViewerOpen() && imagesForViewer().length > 0) {
  <div class="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 animate-fade-in" (click)="closeImageViewer()">
    <div class="relative w-full h-full flex items-center justify-center" (click)="$event.stopPropagation()">
      <!-- Bouton Fermer -->
      <button (click)="closeImageViewer()" class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors rounded-full p-2 bg-black/50 z-10" title="Fermer">
        <i class="fa-solid fa-xmark text-2xl"></i>
      </button>

      <!-- Bouton Précédent -->
      <button (click)="prevImage()" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white transition-colors rounded-full p-3 bg-black/50 hover:bg-black/80" title="Précédent">
        <i class="fa-solid fa-chevron-left text-3xl"></i>
      </button>
      
      <!-- Contenu de l'image -->
      <div class="flex flex-col items-center justify-center w-full max-w-5xl h-full max-h-[90vh]">
        <img [src]="imagesForViewer()[currentImageIndex()].url" [alt]="imagesForViewer()[currentImageIndex()].title"
             class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
        <div class="mt-4 text-center text-white bg-black/50 px-4 py-2 rounded-lg">
          <p class="font-bold text-lg">{{ imagesForViewer()[currentImageIndex()].title }}</p>
          <p class="text-sm">{{ currentImageIndex() + 1 }} / {{ imagesForViewer().length }}</p>
        </div>
      </div>
      
      <!-- Bouton Suivant -->
      <button (click)="nextImage()" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white transition-colors rounded-full p-3 bg-black/50 hover:bg-black/80" title="Suivant">
        <i class="fa-solid fa-chevron-right text-3xl"></i>
      </button>
    </div>
  </div>
}

<!-- Modale PDF -->
@if (isPdfModalOpen()) {
  <div class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-fade-in" (click)="closePdfModal()">
    <div class="bg-gray-200 rounded-lg shadow-2xl p-4 max-w-5xl w-full h-[90vh] flex flex-col" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-center mb-4 pb-2 border-b">
        <h3 class="text-xl font-bold text-gray-800">{{ pdfContentTitle() }}</h3>
        <div class="flex items-center space-x-2">
            <button class="px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center"><i class="fa-solid fa-print mr-2"></i>Imprimer</button>
            <button (click)="closePdfModal()" class="text-gray-400 hover:text-gray-600 transition-colors rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
      </div>
      <div class="flex-grow bg-white shadow-inner overflow-y-auto p-8 font-serif text-gray-800">
        <!-- Contenu du PDF simulé -->
        <div class="w-full">
            <header class="flex justify-between items-center pb-4 border-b">
                <div>
                    <h1 class="text-2xl font-bold">Aéroport</h1>
                    <p class="text-sm">Gestion des Voyageurs Aéroportuaires</p>
                </div>
                <div class="text-right">
                    <p class="text-sm">Généré le: {{ generatedDate }}</p>
                </div>
            </header>

            <main class="mt-8">
                <h2 class="text-xl font-semibold mb-4">{{ pdfContentTitle() }}</h2>
                
                @if (isPdfDataArray()) {
                    <!-- Table for list export -->
                    <table class="min-w-full text-xs border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 p-2 text-left">Identité</th>
                                <th class="border border-gray-300 p-2 text-left">Document</th>
                                <th class="border border-gray-300 p-2 text-left">Vol</th>
                                <th class="border border-gray-300 p-2 text-left">Date</th>
                                <th class="border border-gray-300 p-2 text-left">Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for(item of pdfData(); track item.passager.id_unique) {
                                <tr>
                                    <td class="border border-gray-300 p-2">{{ item.passager.prenom }} {{ item.passager.nom }}</td>
                                    <td class="border border-gray-300 p-2">{{ item.passager.numero_document }}</td>
                                    <td class="border border-gray-300 p-2">{{ item.dernierVoyage.numero_vol }}</td>
                                    <td class="border border-gray-300 p-2">{{ item.dernierVoyage.date_voyage }}</td>
                                    <td class="border border-gray-300 p-2">{{ item.dernierVoyage.statut }}</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                } @else {
                    <!-- Details for single item export -->
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4 p-4 border rounded">
                            <div class="col-span-2"><strong class="font-semibold text-gray-600">Nom Complet:</strong> {{ pdfData().passager.prenom }} {{ pdfData().passager.nom }}</div>
                            <div><strong class="font-semibold text-gray-600">N° Document:</strong> {{ pdfData().passager.numero_document }}</div>
                            <div><strong class="font-semibold text-gray-600">N° Vol (dernier):</strong> {{ pdfData().dernierVoyage.numero_vol }}</div>
                            <div><strong class="font-semibold text-gray-600">Itinéraire (dernier):</strong> {{ pdfData().dernierVoyage.ville_depart }} -> {{ pdfData().dernierVoyage.ville_destination }}</div>
                            <div><strong class="font-semibold text-gray-600">Date (dernier):</strong> {{ pdfData().dernierVoyage.date_voyage }}</div>
                            <div><strong class="font-semibold text-gray-600">Statut (dernier):</strong> {{ pdfData().dernierVoyage.statut }}</div>
                            <div><strong class="font-semibold text-gray-600">Nombre total de voyages:</strong> {{ pdfData().nombreVoyages }}</div>
                        </div>
                    </div>
                }
            </main>

            <footer class="mt-16 pt-4 border-t text-center text-xs text-gray-500">
                <p>Document confidentiel généré par le système Aéroport.</p>
            </footer>
        </div>
      </div>
    </div>
  </div>
}
