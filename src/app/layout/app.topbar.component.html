<div class="layout-topbar">
    <div class="layout-topbar-start">
        
        <a class="layout-topbar-logo" routerLink="/">
            <i class="pi pi-send text-green-500 text-3xl"></i>
            <span class="text-2xl font-bold ml-3" style="color: rgb(255 255 255);">A√©roport</span>
        </a>
        <a #menuButton class="layout-menu-button" (click)="onMenuButtonClick()" pRipple>
            <i class="pi pi-chevron-right"></i>
        </a>

        <a #mobileMenuButton class="layout-topbar-mobile-button" (click)="onMobileTopbarMenuButtonClick()" pRipple>
            <i class="pi pi-ellipsis-v"></i>
        </a>
    </div>


    <div class="layout-topbar-end">
        <div class="layout-topbar-actions-start">
            <!-- <p-megaMenu [model]="model" styleClass="layout-megamenu"></p-megaMenu> -->
        </div>
        
        <div class="layout-topbar-actions-end">
            <ul class="layout-topbar-items">
                <!-- üîî NOTIFICATIONS -->
                <li class="notification-item">
                    <button class="notification-button" 
                            type="button"
                            pStyleClass="@next" 
                            enterFromClass="ng-hidden" 
                            enterActiveClass="px-scalein" 
                            leaveToClass="ng-hidden" 
                            leaveActiveClass="px-fadeout" 
                            [hideOnOutsideClick]="true"
                            [attr.aria-label]="'Notifications (' + notificationCount + ')'"
                            pRipple>
                        <i class="pi pi-bell notification-icon" aria-hidden="true"></i>
                        <span class="notification-badge" 
                              *ngIf="notificationCount > 0"
                              [attr.aria-label]="notificationCount + ' notifications non lues'">
                            {{ notificationCount > 99 ? '99+' : notificationCount }}
                        </span>
                    </button>
                    
                    <!-- Dropdown des notifications -->
                    <div class="ng-hidden notification-dropdown" role="menu">
                        <div class="notification-header">
                            <h4 class="notification-title">Notifications</h4>
                            <span class="notification-count-text">
                                {{ notificationCount }} nouvelle{{ notificationCount > 1 ? 's' : '' }}
                            </span>
                        </div>
                        
                        <!-- Loader -->
                        <div class="notification-loading" *ngIf="loading">
                            <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
                            <p>Chargement...</p>
                        </div>
                        
                        <!-- Liste des notifications -->
                        <ul class="notification-list" 
                            *ngIf="!loading && recentNotifications.length > 0" 
                            role="list">
                            <li class="notification-item-detail" 
                                *ngFor="let notification of recentNotifications; trackBy: trackByNotificationId"
                                (click)="onNotificationClick(notification)"
                                [class.unread]="!notification.isRead"
                                role="menuitem"
                                tabindex="0"
                                (keydown.enter)="onNotificationClick(notification)"
                                (keydown.space)="$event.preventDefault(); onNotificationClick(notification)">
                                <div class="notification-icon-wrapper" [ngClass]="notification.type">
                                    <i [class]="'pi ' + notification.icon" aria-hidden="true"></i>
                                </div>
                                <div class="notification-content">
                                    <h5 class="notification-item-title">{{ notification.title }}</h5>
                                    <p class="notification-item-message">{{ notification.message }}</p>
                                    <span class="notification-time">{{ notification.time }}</span>
                                </div>
                            </li>
                        </ul>
                        
                        <!-- Message si aucune notification -->
                        <div class="notification-empty" *ngIf="!loading && recentNotifications.length === 0">
                            <i class="pi pi-bell-slash" aria-hidden="true"></i>
                            <p>Aucune notification r√©cente</p>
                        </div>
                        
                        <!-- Footer -->
                        <div class="notification-footer" *ngIf="!loading && recentNotifications.length > 0">
                            <button type="button"
                                    (click)="viewAllNotifications()" 
                                    class="view-all-link">
                                Voir toutes les notifications
                            </button>
                        </div>
                    </div>
                </li>

                <!-- üë§ PROFIL UTILISATEUR -->
                <li class="user-profile-item">
                    <button class="user-profile-button"
                            type="button"
                            pStyleClass="@next" 
                            enterFromClass="ng-hidden" 
                            enterActiveClass="px-scalein" 
                            leaveToClass="ng-hidden" 
                            leaveActiveClass="px-fadeout" 
                            [hideOnOutsideClick]="true"
                            [attr.aria-label]="'Menu utilisateur de ' + getUserFullName()"
                            pRipple>
                        <div class="flex align-items-center gap-2">
                            <div class="user-avatar" 
                                 [attr.aria-label]="'Avatar de ' + getUserFullName()">
                                <span aria-hidden="true">{{ getUserInitials() }}</span>
                            </div>
                            <span class="user-name hidden lg:inline-block">
                                {{ getUserFullName() }}
                            </span>
                            <i class="pi pi-chevron-down hidden lg:inline-block" 
                               style="font-size: 0.75rem; color: white;" 
                               aria-hidden="true"></i>
                        </div>
                    </button>
                    
                    <!-- Dropdown utilisateur -->
                    <div class="ng-hidden user-dropdown" role="menu">
                        <ul class="list-none p-0 m-0">
                            <!-- En-t√™te avec infos -->
                            <li class="user-dropdown-header">
                                <div class="flex align-items-center gap-3 p-3">
                                    <div class="user-avatar-large" 
                                         [attr.aria-label]="'Avatar de ' + getUserFullName()">
                                        <span aria-hidden="true">{{ getUserInitials() }}</span>
                                    </div>
                                    <div class="flex-1 overflow-hidden">
                                        <div class="font-semibold text-900 text-overflow-ellipsis overflow-hidden white-space-nowrap">
                                            {{ getUserFullName() }}
                                        </div>
                                        <div class="text-sm text-600 text-overflow-ellipsis overflow-hidden white-space-nowrap">
                                            {{ user?.email || 'N/A' }}
                                        </div>
                                        <div class="text-xs text-500 mt-1" *ngIf="user?.profil?.libelle">
                                            <i class="pi pi-shield mr-1" aria-hidden="true"></i>
                                            {{ user?.profil?.libelle }}
                                        </div>
                                    </div>
                                </div>
                            </li>

                            <li class="divider" role="separator"></li>

                            <!-- Menu Profil -->
                            <li>
                                <button type="button"
                                        class="flex align-items-center p-3 w-full cursor-pointer user-menu-item" 
                                        (click)="viewProfile()"
                                        role="menuitem">
                                    <i class="pi pi-user mr-3 text-primary" aria-hidden="true"></i>
                                    <span>Mon profil</span>
                                </button>
                            </li>

                            <li class="divider" role="separator"></li>

                            <!-- D√©connexion -->
                            <li>
                                <button type="button"
                                        class="flex align-items-center p-3 w-full cursor-pointer user-menu-item logout-item" 
                                        (click)="logout()"
                                        role="menuitem">
                                    <i class="pi pi-sign-out mr-3" aria-hidden="true"></i>
                                    <span>D√©connexion</span>
                                </button>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>


    </div>
</div>


