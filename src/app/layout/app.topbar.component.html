<div class="layout-topbar">
    <div class="layout-topbar-start">
        
        <a class="layout-topbar-logo" routerLink="/">
            <i class="pi pi-send text-green-500 text-3xl"></i>
            <span class="text-2xl font-bold ml-3" style="color: rgb(255 255 255);">A√©roport</span>
        </a>
        <a #menuButton class="layout-menu-button" (click)="onMenuButtonClick()" pRipple>
            <i class="pi pi-chevron-right"></i>
        </a>

        <a #mobileMenuButton class="layout-topbar-mobile-button" (click)="onMobileTopbarMenuButtonClick()" pRipple>
            <i class="pi pi-ellipsis-v"></i>
        </a>
    </div>

    <div class="layout-topbar-end">
        <div class="layout-topbar-actions-start">
            <!-- <p-megaMenu [model]="model" styleClass="layout-megamenu"></p-megaMenu> -->
        </div>
        <div class="layout-topbar-actions-end">
            <ul class="layout-topbar-items">

                <!-- üîî IC√îNE D'ALERTE -->
                <li class="notification-item">
                    <a class="notification-button" 
                       pStyleClass="@next" 
                       enterFromClass="ng-hidden" 
                       enterActiveClass="px-scalein" 
                       leaveToClass="ng-hidden" 
                       leaveActiveClass="px-fadeout" 
                       [hideOnOutsideClick]="true" 
                       pRipple>
                        <i class="pi pi-bell notification-icon"></i>
                        <!-- Badge avec nombre de notifications -->
                        <span class="notification-badge" *ngIf="notificationCount > 0">
                            {{notificationCount > 99 ? '99+' : notificationCount}}
                        </span>
                    </a>
                    
                    <!-- Dropdown des notifications -->
                    <div class="ng-hidden notification-dropdown">
                        <div class="notification-header">
                            <h4>Notifications</h4>
                            <span class="notification-count-text">{{notificationCount}} nouvelle(s)</span>
                        </div>
                        
                        <!-- Liste des notifications -->
                        <ul class="notification-list" *ngIf="recentNotifications.length > 0">
                            <li class="notification-item-detail" 
                                *ngFor="let notification of recentNotifications"
                                (click)="onNotificationClick(notification)">
                                <div class="notification-icon-wrapper" [ngClass]="notification.type">
                                    <i [class]="'pi ' + notification.icon"></i>
                                </div>
                                <div class="notification-content">
                                    <h5>{{notification.title}}</h5>
                                    <p>{{notification.message}}</p>
                                    <span class="notification-time">{{notification.time}}</span>
                                </div>
                            </li>
                        </ul>
                        
                        <!-- Message si aucune notification -->
                        <div class="notification-empty" *ngIf="recentNotifications.length === 0">
                            <i class="pi pi-bell-slash"></i>
                            <p>Aucune notification r√©cente</p>
                        </div>
                        
                        <!-- Footer -->
                        <div class="notification-footer">
                            <a (click)="viewAllNotifications()" class="view-all-link" style="cursor: pointer;">
                                Voir toutes les notifications
                            </a>
                        </div>
                    </div>
                </li>

                <!-- üë§ PROFIL UTILISATEUR -->
                <li class="user-profile-item">
                    <a class="user-profile-button"
                       pStyleClass="@next" 
                       enterFromClass="ng-hidden" 
                       enterActiveClass="px-scalein" 
                       leaveToClass="ng-hidden" 
                       leaveActiveClass="px-fadeout" 
                       [hideOnOutsideClick]="true" 
                       pRipple>
                        <div class="flex align-items-center gap-2">
                            <!-- Avatar avec initiales -->
                            <div class="user-avatar">
                                <span>{{ getUserInitials() }}</span>
                            </div>
                            <!-- Nom (cach√© sur mobile) -->
                            <span class="user-name hidden lg:inline-block">
                                {{ getUserFullName() }}
                            </span>
                            <i class="pi pi-chevron-down hidden lg:inline-block" style="font-size: 0.75rem; color: white;"></i>
                        </div>
                    </a>
                    
                    <!-- Dropdown utilisateur -->
                    <div class="ng-hidden user-dropdown">
                        <ul class="list-none p-0 m-0">
                            <!-- En-t√™te avec infos -->
                            <li class="user-dropdown-header">
                                <div class="flex align-items-center gap-3 p-3">
                                    <div class="user-avatar-large">
                                        <span>{{ getUserInitials() }}</span>
                                    </div>
                                    <div class="flex-1 overflow-hidden">
                                        <div class="font-semibold text-900 text-overflow-ellipsis overflow-hidden white-space-nowrap">
                                            {{ getUserFullName() }}
                                        </div>
                                        <div class="text-sm text-600 text-overflow-ellipsis overflow-hidden white-space-nowrap">
                                            {{ user?.email || 'N/A' }}
                                        </div>
                                        <div class="text-xs text-500 mt-1" *ngIf="user?.profil?.libelle">
                                            <i class="pi pi-shield mr-1"></i>{{ user?.profil?.libelle }}
                                        </div>
                                    </div>
                                </div>
                            </li>

                            <!-- Divider -->
                            <li class="divider"></li>

                            <!-- Menu Profil -->
                            <li>
                                <a class="flex align-items-center p-3 cursor-pointer user-menu-item" 
                                   (click)="viewProfile()">
                                    <i class="pi pi-user mr-3 text-primary"></i>
                                    <span>Mon profil</span>
                                </a>
                            </li>

                           

                            <!-- Divider -->
                            <li class="divider"></li>

                            <!-- D√©connexion -->
                            <li>
                                <a class="flex align-items-center p-3 cursor-pointer user-menu-item logout-item" 
                                   (click)="logout()">
                                    <i class="pi pi-sign-out mr-3"></i>
                                    <span>D√©connexion</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>