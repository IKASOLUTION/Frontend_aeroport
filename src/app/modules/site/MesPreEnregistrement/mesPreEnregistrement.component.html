<!-- mesPreEnregistrement.component.html - VERSION FRONT OFFICE MODERNE -->

<div class="public-enregistrement-page p-4">
    <!-- ✅ Navbar en premier -->
    <app-navbar></app-navbar>

    <!-- ✅ Header juste après le navbar -->
    <div class="page-header">
        <div class="container">
            <h1 class="page-title">Mes Enregistrements</h1>
            <p class="page-subtitle">Consultez et gérez vos réservations de vols en toute simplicité</p>
        </div>
    </div>

    <!-- Section de recherche -->
    <div class="search-section">
        <div class="container">
            <div class="search-card">
                <div class="search-header">
                    <i class="pi pi-search"></i>
                    <h2>Rechercher mes vols</h2>
                </div>

                <div class="search-controls">
                    <button class="btn-filter" (click)="openFilterDialog()">
                        <i class="pi pi-filter"></i>
                        Filtrer mes réservations
                        <span class="filter-count" *ngIf="selectedStatuts.length > 0">
                            {{selectedStatuts.length}}
                        </span>
                    </button>
                </div>

                <!-- Filtres actifs -->
                <div class="active-filters" *ngIf="dateDebut && dateFin">
                    <span class="filter-tag">
                        <i class="pi pi-calendar"></i>
                        Du {{dateDebut | date:'dd/MM/yyyy'}} au {{dateFin | date:'dd/MM/yyyy'}}
                    </span>
                    <button class="btn-clear-filters" (click)="resetFilters()">
                        <i class="pi pi-times"></i>
                        Réinitialiser
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Section des résultats -->
    <div class="results-section">
        <div class="container">
            <!-- État de chargement -->
            <div class="loading-state" *ngIf="loading()">
                <i class="pi pi-spin pi-spinner"></i>
                <p>Chargement de vos réservations...</p>
            </div>

            <!-- État vide -->
            <div class="empty-state" *ngIf="!loading() && enregistrementList().length === 0">
                <i class="pi pi-inbox"></i>
                <h3>Aucun enregistrement trouvé</h3>
                <p>Modifiez vos critères de recherche pour afficher vos réservations</p>
                <button class="btn-primary" (click)="resetFilters()">
                    <i class="pi pi-refresh"></i>
                    Réinitialiser les filtres
                </button>
            </div>

            <!-- Grille de résultats -->
            <div class="results-grid" *ngIf="!loading() && enregistrementList().length > 0">
                <p-table #dt [value]="enregistrementList()"
                    [globalFilterFields]="['nomFamille', 'prenom', 'numeroDocument', 'nationalite', 'aeroportDepart', 'aeroportDestination']">
                    <ng-template pTemplate="body" let-enregistrement>
                        <div class="flight-card">
                            <!-- En-tête de la carte -->
                            <div class="card-header">
                                <div class="passenger-info">
                                    <div class="avatar">
                                        <i class="pi pi-user"></i>
                                    </div>
                                    <div class="passenger-details">
                                        <h3>{{enregistrement.nomFamille}} {{enregistrement.prenom}}</h3>
                                        <p class="document-info">
                                            <i class="pi pi-id-card"></i>
                                            {{enregistrement.typeDocument}}: {{enregistrement.numeroDocument}}
                                        </p>
                                    </div>
                                </div>
                                <div class="status-badge" [ngClass]="'status-' + enregistrement.statut?.toLowerCase()">
                                    {{enregistrement.statut}}
                                </div>
                            </div>

                            <!-- Itinéraire du vol -->
                            <div class="flight-route">
                                <div class="route-point">
                                    <div class="location-icon">
                                        <i class="pi pi-map-marker"></i>
                                    </div>
                                    <div class="location-details">
                                        <span class="location-label">Départ</span>
                                        <span class="location-name">{{enregistrement.aeroportDepart}}</span>
                                    </div>
                                </div>

                                <div class="route-line">
                                    <i class="pi pi-arrow-right"></i>
                                </div>

                                <div class="route-point">
                                    <div class="location-icon">
                                        <i class="pi pi-map-marker"></i>
                                    </div>
                                    <div class="location-details">
                                        <span class="location-label">Arrivée</span>
                                        <span class="location-name">{{enregistrement.aeroportDestination}}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Détails du vol -->
                            <div class="flight-details">
                                <div class="detail-item">
                                    <i class="pi pi-calendar"></i>
                                    <div>
                                        <span class="detail-label">Date</span>
                                        <span class="detail-value">{{enregistrement.dateVoyage | date:'dd/MM/yyyy'}}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="pi pi-clock"></i>
                                    <div>
                                        <span class="detail-label">Heure</span>
                                        <span class="detail-value">{{enregistrement.heureVoyage}}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="pi pi-globe"></i>
                                    <div>
                                        <span class="detail-label">Nationalité</span>
                                        <span class="detail-value">{{enregistrement.nationalite}}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Pied de carte -->
                            <div class="card-footer">
                                <button class="btn-details" (click)="selectEnregistrement(enregistrement)">
                                    <i class="pi pi-eye"></i>
                                    Voir les détails complets
                                </button>
                            </div>
                        </div>
                    </ng-template>
                </p-table>
            </div>

            <!-- Pagination -->
            <div class="pagination-container" *ngIf="!loading() && enregistrementList().length > 0">
                <p-paginator 
                    [rows]="rows" 
                    [totalRecords]="totalItems" 
                    [rowsPerPageOptions]="[10, 20, 30]"
                    (onPageChange)="onPageChange($event)" 
                    [first]="first">
                </p-paginator>
            </div>
        </div>
    </div>
</div>

<!-- Dialogue de filtres -->
<p-dialog 
    [(visible)]="filterDialog" 
    [modal]="true" 
    [draggable]="false" 
    [style]="{width: '550px', maxWidth: '95vw'}"
    header="Filtrer mes réservations" 
    styleClass="filter-dialog">

    <form [formGroup]="filterFormGroup">
        <!-- Période du voyage -->
        <div class="filter-group">
            <label>
                <i class="pi pi-calendar"></i>
                Période du voyage
            </label>
            <div class="date-range">
                <div class="date-input">
                    <label class="small-label">Date de début</label>
                    <p-calendar 
                        formControlName="dateDebut" 
                        dateFormat="dd/mm/yy" 
                        [showIcon]="true" 
                        placeholder="Sélectionner"
                        [maxDate]="filterFormGroup.get('dateFin')?.value">
                    </p-calendar>
                </div>
                <div class="date-input">
                    <label class="small-label">Date de fin</label>
                    <p-calendar 
                        formControlName="dateFin" 
                        dateFormat="dd/mm/yy" 
                        [showIcon]="true" 
                        placeholder="Sélectionner"
                        [minDate]="filterFormGroup.get('dateDebut')?.value">
                    </p-calendar>
                </div>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <div class="dialog-footer">
            <button pButton label="Réinitialiser" class="p-button-text" (click)="resetFilters()">
            </button>
            <button pButton label="Appliquer les filtres" icon="pi pi-check" class="p-button-primary" (click)="applyFilters()">
            </button>
        </div>
    </ng-template>
</p-dialog>



<!-- Notifications -->
<p-toast position="top-right"></p-toast>

<!-- Spinner de chargement -->
<app-loading-spinner></app-loading-spinner>