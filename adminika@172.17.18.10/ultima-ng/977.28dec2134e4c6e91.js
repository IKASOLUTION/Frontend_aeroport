"use strict";(self.webpackChunkultima_ng=self.webpackChunkultima_ng||[]).push([[977],{7484:(x,m,n)=>{n.r(m),n.d(m,{LoginComponent:()=>D});var e=n(9212),c=n(5961),o=n(95),l=n(6814),_=n(707),r=n(3714),g=n(8057),s=n(4480),a=n(7213),p=n(8645),b=n(9773),f=n(5802),E=n(5180),M=n(5219);function C(d,Z){1&d&&(e.TgZ(0,"div",36)(1,"div",19),e._UZ(2,"i",37),e.TgZ(3,"p",38),e._uU(4,"Nom d'utilisateur ou mot de passe incorrect"),e.qZA()()())}function T(d,Z){1&d&&(e.TgZ(0,"div",39)(1,"div",40),e._UZ(2,"i",41),e.qZA(),e.TgZ(3,"h3",42),e._uU(4,"Mot de passe oubli\xe9 ?"),e.qZA()())}const O=()=>({width:"28rem"});let D=(()=>{class d{constructor(i,t,u,h){this.router=i,this.loginService=t,this.stateStorageService=u,this.authenticationError=(0,e.tdS)(!1),this.errorMessage=(0,e.tdS)("Nom d'utilisateur ou mot de passe incorrect"),this.isLoading=(0,e.tdS)(!1),this.rememberMe=(0,e.tdS)(!0),this.modalMotDePasseOublieOuvert=(0,e.tdS)(!1),this.destroy$=new p.x,this.form=h.group({username:["",o.kI.compose([o.kI.required,o.kI.minLength(3)])],password:["",o.kI.compose([o.kI.required,o.kI.minLength(3)])]})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}toggleRememberMe(){this.rememberMe.update(i=>!i)}ouvrirModal(){this.modalMotDePasseOublieOuvert.set(!0)}fermerModal(){this.modalMotDePasseOublieOuvert.set(!1)}hasFieldError(i){const t=this.form.get(i);return!(!t||!t.invalid||!t.dirty&&!t.touched)}getFieldError(i){const t=this.form.get(i);return t&&t.errors?t.errors.required?"Ce champ est requis":t.errors.minlength?`Minimum ${t.errors.minlength.requiredLength} caract\xe8res requis`:"Champ invalide":""}login(){if(console.log("==================this.form=============",this.form),this.form.valid){this.isLoading.set(!0),this.authenticationError.set(!1);const i={login:this.form.value.username,password:this.form.value.password,rememberMe:this.rememberMe()};console.log("==================credentials=============",i),this.loginService.login(i).pipe((0,b.R)(this.destroy$)).subscribe({next:t=>{console.log("5. Connexion r\xe9ussie - R\xe9ponse compl\xe8te:",t),console.log("6. V\xe9rification token:",this.loginService.getStoredAuthenticationToken()),console.log("7. V\xe9rification utilisateur:",this.loginService.getStoredUser()),this.authenticationError.set(!1),setTimeout(()=>{console.log("8. D\xe9but de la redirection"),this.handleSuccessfulLogin()},100)},error:t=>{console.error("\xc9chec de la connexion:",t),this.authenticationError.set(!0),this.handleLoginError(t),this.isLoading.set(!1)}})}else this.markFormGroupTouched()}handleSuccessfulLogin(){try{if(!this.loginService.isAuthenticated())return console.error("Utilisateur non authentifi\xe9 apr\xe8s login"),this.authenticationError.set(!0),this.errorMessage.set("Erreur d'authentification. Veuillez r\xe9essayer."),void this.isLoading.set(!1);console.log("9. Utilisateur authentifi\xe9, navigation vers dashboard"),this.router.navigateByUrl("/admin/dashboard").then(i=>{console.log("10. Navigation r\xe9ussie:",i),this.isLoading.set(!1),i||(console.error("Navigation \xe9chou\xe9e, tentative de fallback"),window.location.href="/admin/dashboard")},i=>{console.error("11. Erreur navigation:",i),this.isLoading.set(!1),window.location.href="/admin/dashboard"})}catch(i){console.error("Erreur lors de la redirection:",i),this.isLoading.set(!1),window.location.href="/admin/dashboard"}}handleLoginError(i){this.errorMessage.set(401===i.status?"Nom d'utilisateur ou mot de passe incorrect":0===i.status?"Erreur de connexion au serveur":"Erreur de connexion. Veuillez r\xe9essayer."),setTimeout(()=>{const t=document.getElementById("username");t&&t.focus()},100)}markFormGroupTouched(){Object.keys(this.form.controls).forEach(i=>{const t=this.form.get(i);t&&(t.markAsTouched(),t.markAsDirty())})}register(){this.router.navigate(["/inscription"])}requestResetPassword(){this.router.navigate(["/reset","request"])}static#e=this.\u0275fac=function(t){return new(t||d)(e.Y36(c.F0),e.Y36(f.r),e.Y36(E.L),e.Y36(o.qu))};static#t=this.\u0275cmp=e.Xpm({type:d,selectors:[["app-login"]],standalone:!0,features:[e.jDz],decls:53,vars:9,consts:[[1,"min-h-screen","bg-gray-50","flex","flex-column","justify-content-center","py-6","px-3"],[1,"mx-auto","w-full",2,"max-width","28rem"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-send","text-green-600","text-4xl"],[1,"text-4xl","font-bold","ml-3","text-gray-800"],[1,"mt-6","text-center","text-3xl","font-bold","text-gray-900"],[1,"mt-5","mx-auto","w-full",2,"max-width","28rem"],[1,"surface-card","py-5","px-4","shadow-4","border-round-lg","relative"],[1,"absolute","top-0","left-0","right-0","border-round-top-lg",2,"height","0.5rem","background","linear-gradient(to right, #EF3340, #FCD116, #009E49)"],["class","mb-4 p-3 bg-red-50 border-left-4 border-red-500 border-round",4,"ngIf"],[1,"flex","flex-column","gap-4",3,"formGroup","ngSubmit"],["for","username",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"p-input-icon-left","w-full"],[1,"pi","pi-user","text-gray-400"],["id","username","formControlName","username","type","text","pInputText","","placeholder","votre.nom@exemple.com",1,"w-full"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"pi","pi-lock","text-gray-400"],["id","password","formControlName","password","type","password","pInputText","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full"],[1,"flex","align-items-center","justify-content-between"],[1,"flex","align-items-center"],["inputId","remember-me","styleClass","mr-2",3,"binary"],["for","remember-me",1,"text-sm","text-gray-900","cursor-pointer","m-0"],[1,"text-sm"],["type","button",1,"p-0","border-none","bg-transparent","font-medium","text-green-600","hover:text-green-500","cursor-pointer",3,"click"],["pButton","","pRipple","","type","submit","label","Se connecter",1,"w-full","p-button-success"],[1,"mt-4","text-center"],[1,"text-sm","text-gray-600","m-0"],["routerLink","/inscription",1,"font-medium","text-green-600","hover:text-green-500","no-underline"],["styleClass","border-round-xl",3,"visible","modal","closable","visibleChange"],["pTemplate","header"],[1,"text-gray-600","text-center","mb-4"],[1,"flex","flex-column","gap-4",3,"submit"],["for","reset-email",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"pi","pi-envelope","text-gray-400"],["id","reset-email","type","email","pInputText","","placeholder","vous@exemple.com",1,"w-full"],["pButton","","pRipple","","type","submit","label","Envoyer le lien de r\xe9initialisation",1,"w-full","p-button-success"],[1,"mb-4","p-3","bg-red-50","border-left-4","border-red-500","border-round"],[1,"pi","pi-exclamation-circle","text-red-500","mr-3"],[1,"text-sm","text-red-700","m-0"],[1,"flex","flex-column","align-items-center","text-center","w-full"],[1,"bg-green-100","p-3","border-round-circle","mb-3"],[1,"pi","pi-key","text-green-600","text-2xl"],[1,"text-2xl","font-bold","text-gray-800","m-0"]],template:function(t,u){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"i",3),e.TgZ(4,"h1",4),e._uU(5,"A\xe9roport"),e.qZA()(),e.TgZ(6,"h2",5),e._uU(7," Connectez-vous \xe0 votre compte "),e.qZA()(),e.TgZ(8,"div",6)(9,"div",7),e._UZ(10,"div",8),e.YNc(11,C,5,0,"div",9),e.TgZ(12,"form",10),e.NdJ("ngSubmit",function(){return u.login()}),e.TgZ(13,"div")(14,"label",11),e._uU(15," Nom d'utilisateur ou Email "),e.qZA(),e.TgZ(16,"span",12),e._UZ(17,"i",13)(18,"input",14),e.qZA()(),e.TgZ(19,"div")(20,"label",15),e._uU(21," Mot de passe "),e.qZA(),e.TgZ(22,"span",12),e._UZ(23,"i",16)(24,"input",17),e.qZA()(),e.TgZ(25,"div",18)(26,"div",19),e._UZ(27,"p-checkbox",20),e.TgZ(28,"label",21),e._uU(29," Se souvenir de moi "),e.qZA()(),e.TgZ(30,"div",22)(31,"button",23),e.NdJ("click",function(){return u.ouvrirModal()}),e._uU(32," Mot de passe oubli\xe9? "),e.qZA()()(),e.TgZ(33,"div"),e._UZ(34,"button",24),e.qZA()(),e.TgZ(35,"div",25)(36,"p",26),e._uU(37," Pas encore de compte? "),e.TgZ(38,"a",27),e._uU(39," Inscrivez-vous ici "),e.qZA()()()()()(),e.TgZ(40,"p-dialog",28),e.NdJ("visibleChange",function(v){return u.modalMotDePasseOublieOuvert.set(v)}),e.YNc(41,T,5,0,"ng-template",29),e.TgZ(42,"p",30),e._uU(43," Pas de soucis. Entrez votre adresse e-mail ci-dessous et nous vous enverrons un lien pour le r\xe9initialiser. "),e.qZA(),e.TgZ(44,"form",31),e.NdJ("submit",function(v){return v.preventDefault(),u.fermerModal()}),e.TgZ(45,"div")(46,"label",32),e._uU(47,"Adresse e-mail"),e.qZA(),e.TgZ(48,"span",12),e._UZ(49,"i",33)(50,"input",34),e.qZA()(),e.TgZ(51,"div"),e._UZ(52,"button",35),e.qZA()()()),2&t&&(e.xp6(11),e.Q6J("ngIf",u.authenticationError),e.xp6(1),e.Q6J("formGroup",u.form),e.xp6(15),e.Q6J("binary",!0),e.xp6(13),e.Akn(e.DdM(8,O)),e.Q6J("visible",u.modalMotDePasseOublieOuvert())("modal",!0)("closable",!0))},dependencies:[l.ez,l.O5,_.hJ,_.Hq,M.jx,r.j,r.o,g.nD,g.XZ,o.u5,o._Y,o.Fj,o.JJ,o.JL,o.F,s.T,s.H,o.UX,o.sg,o.u,c.Bz,c.rH,a.S,a.V],styles:['@charset "UTF-8";.section-authentication-signin[_ngcontent-%COMP%]{position:relative;background-image:url(/assets/images/dgi-siege.jpg);background-size:cover;background-position:center;background-repeat:no-repeat;min-height:100vh}.section-authentication-signin[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:rgba(0,0,0,.4);z-index:0}.section-authentication-signin[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:relative;z-index:1}.login-container[_ngcontent-%COMP%]{position:absolute}.login-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{width:80px;height:80px;margin:-40px auto 0;border-radius:50%;font-size:36px}']})}return d})()},7778:(x,m,n)=>{n.d(m,{q:()=>o});var e=n(9212),c=n(4713);let o=(()=>{class l extends c.s{static \u0275fac=(()=>{let r;return function(s){return(r||(r=e.n5z(l)))(s||l)}})();static \u0275cmp=e.Xpm({type:l,selectors:[["TimesIcon"]],standalone:!0,features:[e.qOj,e.jDz],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.01186 7.00933L12.27 2.75116C12.341 2.68501 12.398 2.60524 12.4375 2.51661C12.4769 2.42798 12.4982 2.3323 12.4999 2.23529C12.5016 2.13827 12.4838 2.0419 12.4474 1.95194C12.4111 1.86197 12.357 1.78024 12.2884 1.71163C12.2198 1.64302 12.138 1.58893 12.0481 1.55259C11.9581 1.51625 11.8617 1.4984 11.7647 1.50011C11.6677 1.50182 11.572 1.52306 11.4834 1.56255C11.3948 1.60204 11.315 1.65898 11.2488 1.72997L6.99067 5.98814L2.7325 1.72997C2.59553 1.60234 2.41437 1.53286 2.22718 1.53616C2.03999 1.53946 1.8614 1.61529 1.72901 1.74767C1.59663 1.88006 1.5208 2.05865 1.5175 2.24584C1.5142 2.43303 1.58368 2.61419 1.71131 2.75116L5.96948 7.00933L1.71131 11.2675C1.576 11.403 1.5 11.5866 1.5 11.7781C1.5 11.9696 1.576 12.1532 1.71131 12.2887C1.84679 12.424 2.03043 12.5 2.2219 12.5C2.41338 12.5 2.59702 12.424 2.7325 12.2887L6.99067 8.03052L11.2488 12.2887C11.3843 12.424 11.568 12.5 11.7594 12.5C11.9509 12.5 12.1346 12.424 12.27 12.2887C12.4053 12.1532 12.4813 11.9696 12.4813 11.7781C12.4813 11.5866 12.4053 11.403 12.27 11.2675L8.01186 7.00933Z","fill","currentColor"]],template:function(g,s){1&g&&(e.O4$(),e.TgZ(0,"svg",0),e._UZ(1,"path",1),e.qZA()),2&g&&(e.Tol(s.getClassNames()),e.uIk("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role))},encapsulation:2})}return l})()},3714:(x,m,n)=>{n.d(m,{j:()=>_,o:()=>l});var e=n(9212),c=n(6814),o=n(95);let l=(()=>{class r{el;ngModel;cd;filled;constructor(s,a,p){this.el=s,this.ngModel=a,this.cd=p}ngAfterViewInit(){this.updateFilledState(),this.cd.detectChanges()}ngDoCheck(){this.updateFilledState()}onInput(){this.updateFilledState()}updateFilledState(){this.filled=this.el.nativeElement.value&&this.el.nativeElement.value.length||this.ngModel&&this.ngModel.model}static \u0275fac=function(a){return new(a||r)(e.Y36(e.SBq),e.Y36(o.On,8),e.Y36(e.sBO))};static \u0275dir=e.lG2({type:r,selectors:[["","pInputText",""]],hostAttrs:[1,"p-inputtext","p-component","p-element"],hostVars:2,hostBindings:function(a,p){1&a&&e.NdJ("input",function(f){return p.onInput(f)}),2&a&&e.ekj("p-filled",p.filled)}})}return r})(),_=(()=>{class r{static \u0275fac=function(a){return new(a||r)};static \u0275mod=e.oAB({type:r});static \u0275inj=e.cJS({imports:[c.ez]})}return r})()}}]);